<!doctype html>
<html lang="ru">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content"
		/>
		<title>–≠–∫–æ–ø–∞—Ç—Ä—É–ª—å üåç</title>

		<!-- MapLibre -->
		<link
			href="https://unpkg.com/maplibre-gl@4.0.0/dist/maplibre-gl.css"
			rel="stylesheet"
		/>
		<script src="https://unpkg.com/maplibre-gl@4.0.0/dist/maplibre-gl.js"></script>

		<!-- Telegram -->
		<script src="https://telegram.org/js/telegram-web-app.js"></script>

		<link rel="stylesheet" href="style.css" />
	</head>
	<body>
		<!-- Onboarding Screen -->
		<div class="onboarding hidden" id="onboarding">
			<div class="onboarding-content">
				<div class="onboarding-icon">
					<svg
						width="56"
						height="56"
						viewBox="0 0 24 24"
						fill="none"
						stroke="white"
						stroke-width="2"
					>
						<path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
						<circle cx="12" cy="10" r="3" />
					</svg>
				</div>
				<h1 class="onboarding-title">–≠–∫–æ–ø–∞—Ç—Ä—É–ª—å</h1>
				<p class="onboarding-subtitle">–°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è</p>

				<form id="onboarding-form" style="width: 100%">
					<div class="form-group">
						<label class="form-label">–ò–º—è</label>
						<input
							type="text"
							class="form-input"
							id="first-name"
							placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è"
							autocomplete="given-name"
							required
						/>
					</div>

					<div class="form-group">
						<label class="form-label">–§–∞–º–∏–ª–∏—è</label>
						<input
							type="text"
							class="form-input"
							id="last-name"
							placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é"
							autocomplete="family-name"
							required
						/>
					</div>

					<div class="form-group">
						<label class="form-label">–í–æ–∑—Ä–∞—Å—Ç</label>
						<input
							type="number"
							class="form-input"
							id="age"
							placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç"
							min="13"
							max="120"
							inputmode="numeric"
							required
						/>
					</div>

					<div class="form-group">
						<label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
						<input
							type="tel"
							class="form-input"
							id="phone"
							placeholder="+998 (__) ___-__-__"
							autocomplete="tel"
							inputmode="tel"
							required
						/>
					</div>

					<button
						type="submit"
						class="btn btn-primary"
						style="width: 100%; margin-top: 16px; margin-bottom: 24px"
						id="onboarding-submit"
					>
						–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
					</button>
				</form>
			</div>
		</div>

		<!-- Map -->
		<div id="map"></div>

		<!-- Center Marker -->
		<div class="center-marker" id="center-marker">
			<svg width="32" height="40" viewBox="0 0 32 40" fill="none">
				<path
					d="M16 0C7.163 0 0 7.163 0 16c0 11.2 16 24 16 24s16-12.8 16-24C32 7.163 24.837 0 16 0z"
					fill="#059669"
				/>
				<circle cx="16" cy="16" r="6" fill="white" />
			</svg>
		</div>

		<!-- Profile Button -->
		<button class="profile-btn" id="profile-btn">
			<svg
				width="20"
				height="20"
				viewBox="0 0 24 24"
				fill="none"
				stroke="currentColor"
				stroke-width="2"
			>
				<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
				<circle cx="12" cy="7" r="4" />
			</svg>
		</button>

		<!-- Balance Button -->
		<button class="balance-btn" id="balance-btn">
			<svg
				width="20"
				height="20"
				viewBox="0 0 24 24"
				fill="none"
				stroke="currentColor"
				stroke-width="2"
			>
				<line x1="12" y1="1" x2="12" y2="23" />
				<path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
			</svg>
		</button>

		<!-- Visibility Toggle Button -->
		<button class="toggle-pollutions-btn" id="toggle-pollutions-btn">
			<svg
				width="20"
				height="20"
				viewBox="0 0 24 24"
				fill="none"
				stroke="currentColor"
				stroke-width="2"
				id="toggle-icon"
			>
				<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
				<circle cx="12" cy="12" r="3" />
			</svg>
		</button>

		<!-- Geolocation Button (Right) -->
		<button class="geolocate-btn" id="geolocate-btn">
			<svg
				width="20"
				height="20"
				viewBox="0 0 24 24"
				fill="none"
				stroke="currentColor"
				stroke-width="2"
			>
				<path d="M12 2v4m0 12v4M2 12h4m12 0h4" />
				<circle cx="12" cy="12" r="3" />
			</svg>
		</button>

		<!-- Add Pollution Button -->
		<button class="add-btn" id="add-btn">
			<svg
				width="24"
				height="24"
				viewBox="0 0 24 24"
				fill="none"
				stroke="currentColor"
				stroke-width="2.5"
			>
				<path d="M12 5v14M5 12h14" />
			</svg>
		</button>

		<!-- Sidebar (Profile) -->
		<div class="sidebar" id="sidebar">
			<div class="sidebar-header">
				<div class="profile-main">
					<div class="profile-avatar" id="sidebar-avatar">--</div>
					<div class="user-info">
						<div class="user-name" id="sidebar-username">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
						<div class="user-id" id="sidebar-userid">ID: ...</div>
					</div>
				</div>
				<button class="theme-icon-btn" id="theme-toggle">
					<svg
						id="theme-icon"
						width="22"
						height="22"
						viewBox="0 0 24 24"
						fill="none"
						stroke="currentColor"
						stroke-width="2"
					>
						<!-- Sun icon (Light mode default) -->
						<circle cx="12" cy="12" r="5" />
						<line x1="12" y1="1" x2="12" y2="3" />
						<line x1="12" y1="21" x2="12" y2="23" />
						<line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
						<line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
						<line x1="1" y1="12" x2="3" y2="12" />
						<line x1="21" y1="12" x2="23" y2="12" />
						<line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
						<line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
					</svg>
				</button>
			</div>

			<div class="sidebar-content">
				<!-- Stats Grid Section -->
				<div class="stats-grid">
					<div class="stat-item">
						<div class="stat-icon balance">
							<svg
								width="20"
								height="20"
								viewBox="0 0 24 24"
								fill="none"
								stroke="currentColor"
								stroke-width="2"
							>
								<circle cx="12" cy="12" r="10" />
								<path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8" />
								<path d="M12 18V6" />
							</svg>
						</div>
						<div class="stat-info">
							<div class="stat-value" id="sidebar-balance">$0</div>
							<div class="stat-label">–ë–∞–ª–∞–Ω—Å</div>
						</div>
					</div>
					<div class="stat-item">
						<div class="stat-icon cleaned">
							<svg
								width="20"
								height="20"
								viewBox="0 0 24 24"
								fill="none"
								stroke="currentColor"
								stroke-width="2"
							>
								<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
								<polyline points="22 4 12 14.01 9 11.01" />
							</svg>
						</div>
						<div class="stat-info">
							<div class="stat-value" id="sidebar-cleaned">0</div>
							<div class="stat-label">–û—á–∏—â–µ–Ω–æ</div>
						</div>
					</div>
				</div>

				<!-- Menu List Section -->
				<div class="action-menu">
					<div class="menu-item" id="menu-reports">
						<svg
							width="18"
							height="18"
							viewBox="0 0 24 24"
							fill="none"
							stroke="currentColor"
							stroke-width="2"
						>
							<path
								d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
							/>
							<polyline points="14 2 14 8 20 8" />
							<line x1="16" y1="13" x2="8" y2="13" />
							<line x1="16" y1="17" x2="8" y2="17" />
							<polyline points="10 9 9 9 8 9" />
						</svg>
						<span>–ú–æ–∏ –æ—Ç—á–µ—Ç—ã</span>
					</div>
					<div class="menu-item" id="menu-history">
						<svg
							width="18"
							height="18"
							viewBox="0 0 24 24"
							fill="none"
							stroke="currentColor"
							stroke-width="2"
						>
							<circle cx="12" cy="12" r="10" />
							<polyline points="12 6 12 12 16 14" />
						</svg>
						<span>–ò—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π</span>
					</div>
					<div class="menu-item" id="menu-info">
						<svg
							width="18"
							height="18"
							viewBox="0 0 24 24"
							fill="none"
							stroke="currentColor"
							stroke-width="2"
						>
							<circle cx="12" cy="12" r="10" />
							<line x1="12" y1="16" x2="12" y2="12" />
							<line x1="12" y1="8" x2="12.01" y2="8" />
						</svg>
						<span>–û –ø—Ä–æ–µ–∫—Ç–µ</span>
					</div>
				</div>

				<div class="sidebar-footer">EcoPatrol v27.0 ‚Ä¢ –°–¥–µ–ª–∞–µ–º –º–∏—Ä —á–∏—â–µ</div>
			</div>
		</div>

		<!-- Bottom Sheet -->
		<div class="bottom-sheet" id="bottom-sheet">
			<div class="sheet-handle"></div>
			<div class="sheet-content" id="sheet-content">
				<!-- Dynamic content -->
			</div>
		</div>

		<!-- Overlay -->
		<div class="top-vignette"></div>
		<div class="bottom-vignette"></div>
		<div class="overlay" id="overlay"></div>

		<!-- Photo Viewer (Lightbox) -->
		<div
			id="photo-viewer"
			class="photo-viewer"
			onclick="window.closePhotoViewer()"
		>
			<div class="close-viewer" onclick="window.closePhotoViewer()">√ó</div>
			<img
				src=""
				id="viewer-img"
				class="viewer-img"
				onclick="event.stopPropagation()"
			/>
		</div>

		<!-- Debug Console Structure -->
		<button id="debug-toggle-btn">üêû LOGS</button>
		<div id="debug-console"></div>

		<!-- Error Handler for Mobile Debugging -->
		<script>
			// Simple on-screen logger
			const debugConsole = document.getElementById('debug-console')
			const debugBtn = document.getElementById('debug-toggle-btn')

			debugBtn.addEventListener('click', () => {
				debugConsole.classList.toggle('active')
			})

			function logToScreen(msg, type = 'log') {
				const line = document.createElement('div')
				line.style.borderBottom = '1px solid #333'
				line.style.padding = '2px 0'
				line.style.wordBreak = 'break-all'

				if (type === 'error') line.style.color = '#ff5555'
				else if (type === 'warn') line.style.color = '#ffff55'

				line.textContent = `[${new Date().toLocaleTimeString()}] ${String(msg)}`
				debugConsole.appendChild(line)
				debugConsole.scrollTop = debugConsole.scrollHeight
			}

			// Capture Global Errors
			window.onerror = function (msg, url, line) {
				logToScreen(`Global Error: ${msg} \nLine: ${line}`, 'error')
				debugConsole.classList.add('active') // Auto-open on error
				return false
			}

			// Global Click Tracker
			document.addEventListener(
				'click',
				e => {
					logToScreen(`Click: ${e.target.tagName} .${e.target.className}`)
				},
				true,
			)

			// Override Console
			const originalLog = console.log
			const originalError = console.error
			const originalWarn = console.warn

			console.log = function (...args) {
				originalLog.apply(console, args)
				logToScreen(args.join(' '))
			}

			console.error = function (...args) {
				originalError.apply(console, args)
				logToScreen(args.join(' '), 'error')
				debugConsole.classList.add('active') // Auto-open on error
			}

			console.warn = function (...args) {
				originalWarn.apply(console, args)
				logToScreen(args.join(' '), 'warn')
			}

			console.log('Log system ready v10')
		</script>

		<script type="module" src="main.js?v=27"></script>
	</body>
</html>
